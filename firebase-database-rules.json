{
  "rules": {
    // Global read access for all authenticated users
    ".read": "auth != null",
    
    // Admin emails that have full write access
    "admins": {
      ".read": "auth != null",
      ".write": "auth != null && (auth.token.email == 'ohms1384@gmail.com' || auth.token.email == 'mthalve1@gmail.com' || auth.token.email == 'abirsabirhossain@gmail.com')"
    },
    
    // User profiles - users can create and update their own profiles
    "userProfiles": {
      "$uid": {
        ".read": "auth != null",
        ".write": "auth != null && (auth.uid == $uid || auth.token.email == 'ohms1384@gmail.com' || auth.token.email == 'mthalve1@gmail.com' || auth.token.email == 'abirsabirhossain@gmail.com')",
        ".validate": "newData.hasChildren(['uid', 'email', 'displayName', 'role', 'lastActive'])",
        "uid": {
          ".validate": "newData.isString() && newData.val() == $uid"
        },
        "email": {
          ".validate": "newData.isString() && newData.val().matches(/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$/)"
        },
        "displayName": {
          ".validate": "newData.isString() && newData.val().length > 0"
        },
        "role": {
          ".validate": "newData.isString() && (newData.val() == 'admin' || newData.val() == 'user')"
        },
        "lastActive": {
          ".validate": "newData.isNumber()"
        },
        "photoURL": {
          ".validate": "newData.isString()"
        },
        "interactionStats": {
          ".validate": "newData.hasChildren(['totalLikes', 'totalComments', 'joinedAt'])",
          "totalLikes": {
            ".validate": "newData.isNumber() && newData.val() >= 0"
          },
          "totalComments": {
            ".validate": "newData.isNumber() && newData.val() >= 0"
          },
          "joinedAt": {
            ".validate": "newData.isNumber()"
          }
        }
      }
    },
    
    // Notices - admins can create/edit, users can interact
    "notices": {
      ".read": "auth != null",
      ".write": "auth != null && (auth.token.email == 'ohms1384@gmail.com' || auth.token.email == 'mthalve1@gmail.com' || auth.token.email == 'abirsabirhossain@gmail.com')",
      "$noticeId": {
        ".read": "auth != null",
        ".write": "auth != null && (auth.token.email == 'ohms1384@gmail.com' || auth.token.email == 'mthalve1@gmail.com' || auth.token.email == 'abirsabirhossain@gmail.com')",
        
        // Notice interactions (likes and comments)
        "interactions": {
          ".read": "auth != null",
          
          // Likes - users can only add/remove their own likes
          "likes": {
            ".read": "auth != null",
            "$userId": {
              ".read": "auth != null",
              ".write": "auth != null && auth.uid == $userId",
              ".validate": "newData.hasChildren(['userId', 'userEmail', 'userDisplayName', 'timestamp', 'reactionType'])",
              "userId": {
                ".validate": "newData.isString() && newData.val() == auth.uid"
              },
              "userEmail": {
                ".validate": "newData.isString() && newData.val() == auth.token.email"
              },
              "userDisplayName": {
                ".validate": "newData.isString() && newData.val().length > 0"
              },
              "timestamp": {
                ".validate": "newData.isNumber()"
              },
              "reactionType": {
                ".validate": "newData.isString() && (newData.val() == 'like' || newData.val() == 'love' || newData.val() == 'helpful' || newData.val() == 'important')"
              },
              "userPhotoURL": {
                ".validate": "newData.isString()"
              }
            }
          },
          
          // Comments - users can add comments, edit their own, admins can moderate
          "comments": {
            ".read": "auth != null",
            "$commentId": {
              ".read": "auth != null",
              ".write": "auth != null && (auth.uid == newData.child('userId').val() || auth.uid == data.child('userId').val() || auth.token.email == 'ohms1384@gmail.com' || auth.token.email == 'mthalve1@gmail.com' || auth.token.email == 'abirsabirhossain@gmail.com')",
              ".validate": "newData.hasChildren(['id', 'userId', 'userEmail', 'userDisplayName', 'content', 'timestamp', 'isEdited', 'isDeleted'])",
              "id": {
                ".validate": "newData.isString() && newData.val() == $commentId"
              },
              "userId": {
                ".validate": "newData.isString() && (newData.val() == auth.uid || auth.token.email == 'ohms1384@gmail.com' || auth.token.email == 'mthalve1@gmail.com' || auth.token.email == 'abirsabirhossain@gmail.com')"
              },
              "userEmail": {
                ".validate": "newData.isString()"
              },
              "userDisplayName": {
                ".validate": "newData.isString() && newData.val().length > 0"
              },
              "content": {
                ".validate": "newData.isString() && newData.val().length > 0 && newData.val().length <= 1000"
              },
              "timestamp": {
                ".validate": "newData.isNumber()"
              },
              "isEdited": {
                ".validate": "newData.isBoolean()"
              },
              "isDeleted": {
                ".validate": "newData.isBoolean()"
              },
              "editedAt": {
                ".validate": "newData.isNumber()"
              },
              "deletedAt": {
                ".validate": "newData.isNumber()"
              },
              "deletedBy": {
                ".validate": "newData.isString()"
              },
              "isPinned": {
                ".validate": "newData.isBoolean()"
              },
              "userPhotoURL": {
                ".validate": "newData.isString()"
              },
              "parentCommentId": {
                ".validate": "newData.isString()"
              }
            }
          }
        },
        
        // Notice like and comment counts - auto-updated by system
        "likeCount": {
          ".write": "auth != null && (auth.token.email == 'ohms1384@gmail.com' || auth.token.email == 'mthalve1@gmail.com' || auth.token.email == 'abirsabirhossain@gmail.com')",
          ".validate": "newData.isNumber() && newData.val() >= 0"
        },
        "commentCount": {
          ".write": "auth != null && (auth.token.email == 'ohms1384@gmail.com' || auth.token.email == 'mthalve1@gmail.com' || auth.token.email == 'abirsabirhossain@gmail.com')",
          ".validate": "newData.isNumber() && newData.val() >= 0"
        }
      }
    },
    
    // Notes - admin only (no interactions)
    "notes": {
      ".read": "auth != null",
      ".write": "auth != null && (auth.token.email == 'ohms1384@gmail.com' || auth.token.email == 'mthalve1@gmail.com' || auth.token.email == 'abirsabirhossain@gmail.com')"
    },

    // Students - admin only
    "students": {
      ".read": "auth != null",
      ".write": "auth != null && (auth.token.email == 'ohms1384@gmail.com' || auth.token.email == 'mthalve1@gmail.com' || auth.token.email == 'abirsabirhossain@gmail.com')"
    },

    // Classes - admin only
    "classes": {
      ".read": "auth != null",
      ".write": "auth != null && (auth.token.email == 'ohms1384@gmail.com' || auth.token.email == 'mthalve1@gmail.com' || auth.token.email == 'abirsabirhossain@gmail.com')"
    },

    // Attendance - admin only
    "attendance": {
      ".read": "auth != null",
      ".write": "auth != null && (auth.token.email == 'ohms1384@gmail.com' || auth.token.email == 'mthalve1@gmail.com' || auth.token.email == 'abirsabirhossain@gmail.com')"
    },

    // Class cancellations - admin only
    "classCancellations": {
      ".read": "auth != null",
      ".write": "auth != null && (auth.token.email == 'ohms1384@gmail.com' || auth.token.email == 'mthalve1@gmail.com' || auth.token.email == 'abirsabirhossain@gmail.com')"
    },
    
    // User approval system
    "userApprovals": {
      ".read": "auth != null && (auth.token.email == 'ohms1384@gmail.com' || auth.token.email == 'mthalve1@gmail.com' || auth.token.email == 'abirsabirhossain@gmail.com')",
      ".write": "auth != null && (auth.token.email == 'ohms1384@gmail.com' || auth.token.email == 'mthalve1@gmail.com' || auth.token.email == 'abirsabirhossain@gmail.com')",
      "$uid": {
        ".read": "auth != null && (auth.uid == $uid || auth.token.email == 'ohms1384@gmail.com' || auth.token.email == 'mthalve1@gmail.com' || auth.token.email == 'abirsabirhossain@gmail.com')",
        ".write": "auth != null && (auth.uid == $uid || auth.token.email == 'ohms1384@gmail.com' || auth.token.email == 'mthalve1@gmail.com' || auth.token.email == 'abirsabirhossain@gmail.com')"
      }
    }
  }
}
